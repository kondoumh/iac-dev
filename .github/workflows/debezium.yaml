name: "Test debezium"
on: [workflow_dispatch]

jobs:
  Setup:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - uses: engineerd/setup-kind@v0.5.0
      - name: Create namespace
        run: kubectl create namespace wf
      - name: Install PostgreSQL
        run: |
          helm repo add bitnami https://charts.bitnami.com/bitnami
          helm install wf-db bitnami/postgresql -f postgres/values.yaml -n wf
          kubectl wait pod/wf-db-postgresql-0 --for=condition=Ready --timeout=60s -n wf
      - name: Install kafka
        run: |
          helm install wf-kafka-cluster bitnami/kafka -n wf
          kubectl wait po/wf-kafka-cluster-0 --for=condition=Ready --timeout=60s -n wf
      - name: Install debezium connect for PostgreSQL
        run: |
          kubectl apply -f debezium/kafka-connect-deploy.yaml
          kubectl wait deploy/kafkaconnect-deploy --for=condition=Available --timeout=60s -n wf
      - name: Check
        run: kubectl get po,svc -n wf
  